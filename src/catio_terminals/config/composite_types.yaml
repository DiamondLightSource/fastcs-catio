# Composite Type Definitions
# ========================================================
# These are TwinCAT BIGTYPE structures (ads_type=65) that contain multiple
# primitive members. Referenced by type_name in terminal YAML files.
#
# When a terminal's symbol_node has a type_name matching a key here:
# - Simulator uses the type_name for accurate symbol table responses
# - FastCS uses the members list to generate controller attributes
#
# Primitive types (BIT, BOOL, INT, UINT, etc.) are not listed here -
# they map 1:1 to ADS symbols without expansion.

# Composite Symbol Mappings
# ========================================================
# Define how to group primitive symbols from XML into composite types.
# Each mapping specifies:
# - type_name: The composite type to create
# - name_template: Symbol name template with {channel} placeholder
# - group_types: Terminal group types this mapping applies to
# - member_patterns: Patterns to match primitive symbols to composite members

composite_mappings:
  # Analog Input - Standard 16-bit
  - type_name: AI Standard Channel 1_TYPE
    name_template: "AI Standard Channel {channel}"
    group_types:
      - AnaIn
    member_patterns:
      Status:
        - Underrange
        - Overrange
        - Limit
        - Error
        - TxPDO
      Value:
        - Value

  # Analog Input - 24-bit
  - type_name: AI Inputs Channel 1_TYPE
    name_template: "AI Inputs Channel {channel}"
    group_types:
      - AnaIn
    member_patterns:
      Status:
        - Underrange
        - Overrange
        - Limit
        - Error
        - TxPDO
      Value:
        - Value

  # Analog Output
  - type_name: AO Output Channel 1_TYPE
    name_template: "AO Output Channel {channel}"
    group_types:
      - AnaOut
    member_patterns:
      AnalogOutput:
        - Analog output
        - Output

  # Digital Input
  - type_name: Inputs_TYPE
    name_template: "Inputs Channel {channel}"
    group_types:
      - DigIn
    member_patterns:
      Inputs:
        - Input
        - Channel

  # Digital Output
  - type_name: Outputs_TYPE
    name_template: "Outputs Channel {channel}"
    group_types:
      - DigOut
    member_patterns:
      Outputs:
        - Output
        - Channel

  # Counter Input
  - type_name: CNT Inputs_TYPE
    name_template: "CNT Inputs Channel {channel}"
    group_types:
      - Counting
    member_patterns:
      Status:
        - Status
      CounterValue:
        - Counter
        - Value

composite_types:
  # ============================================================
  # Analog Input Types
  # ============================================================

  "AI Standard Channel 1_TYPE":
    description: "16-bit analog input channel (status + value)"
    ads_type: 65 # BIGTYPE
    size: 4
    members:
      - name: Status
        offset: 0
        type_name: UINT
        size: 2
        fastcs_attr: Status
        access: read-only
        description: "Status word for 16-bit analog input"
      - name: Value
        offset: 2
        type_name: INT
        size: 2
        fastcs_attr: Value
        access: read-only
        description: "Value for 16-bit analog input channel"

  "AI Inputs Channel 1_TYPE":
    description: "24-bit analog input channel (status + value)"
    ads_type: 65
    size: 6
    members:
      - name: Status
        offset: 0
        type_name: UINT
        size: 2
        fastcs_attr: Status
        access: read-only
        description: "Status word for 24-bit analog input"
      - name: Value
        offset: 2
        type_name: DINT
        size: 4
        fastcs_attr: Value
        access: read-only
        description: "Value for 24-bit analog input channel"

  # ============================================================
  # Analog Output Types
  # ============================================================

  "AO Output Channel 1_TYPE":
    description: "16-bit analog output channel"
    ads_type: 65
    size: 2
    members:
      - name: AnalogOutput
        offset: 0
        type_name: INT
        size: 2
        fastcs_attr: AnalogOutput
        access: read-write
        description: "Value for 16-bit analog output channel"

  # ============================================================
  # Counter Types
  # ============================================================

  "CNT Inputs_TYPE":
    description: "Counter input (status + counter value)"
    ads_type: 65
    size: 6
    members:
      - name: Status
        offset: 0
        type_name: UINT
        size: 2
        fastcs_attr: Status
        access: read-only
        description: "Status word for digital input counter"
      - name: CounterValue
        offset: 2
        type_name: UDINT
        size: 4
        fastcs_attr: CounterValue
        access: read-only
        description: "Counter value for digital input counter"

  "CNT Outputs_TYPE":
    description: "Counter output (status + set counter value)"
    ads_type: 65
    size: 6
    members:
      - name: Status
        offset: 0
        type_name: UINT
        size: 2
        fastcs_attr: Status
        access: read-only
        description: "Status word for digital output counter"
      - name: SetCounterValue
        offset: 2
        type_name: UDINT
        size: 4
        fastcs_attr: SetCounterValue
        access: read-write
        description: "Set counter value for digital output counter"

  # ============================================================
  # Digital I/O Types
  # ============================================================

  "Channel 1_TYPE":
    description: "Digital input channel"
    ads_type: 65
    size: 1
    members:
      - name: Value
        offset: 0
        type_name: USINT
        size: 1
        fastcs_attr: Value
        access: read-only
        description: "Value for digital input channel"

  # ============================================================
  # Power Supply Types
  # ============================================================

  "Status Uo_TYPE":
    description: "12V power supply status"
    ads_type: 65
    size: 1
    members:
      - name: Status
        offset: 0
        type_name: USINT
        size: 1
        fastcs_attr: Status
        access: read-only
        description: "Power status for 12Vdc power supply unit"

  "Status Us_TYPE":
    description: "24V power supply status"
    ads_type: 65
    size: 1
    members:
      - name: Status
        offset: 0
        type_name: USINT
        size: 1
        fastcs_attr: Status
        access: read-only
        description: "Power status for 24Vdc power supply unit"

  # ============================================================
  # Bus Coupler Types
  # ============================================================

  "ID_TYPE":
    description: "Extension coupler ID"
    ads_type: 65
    size: 2
    members:
      - name: ID
        offset: 0
        type_name: UINT
        size: 2
        fastcs_attr: ID
        access: read-only
        description: "ID for extension coupler terminal"

  # ============================================================
  # EtherCAT Master Device Types
  # ============================================================

  "Inputs_TYPE":
    description: "EtherCAT Master device inputs"
    ads_type: 65
    size: 16
    members:
      - name: Frm0State
        offset: 0
        type_name: UINT
        size: 2
        fastcs_attr: Frm0State
        access: read-only
        description: "Input Frame status"
      - name: Frm0WcState
        offset: 2
        type_name: UINT
        size: 2
        fastcs_attr: Frm0WcState
        access: read-only
        description: "Input Frame working counter status"
      - name: Frm0InputToggle
        offset: 4
        type_name: UINT
        size: 2
        fastcs_attr: Frm0InputToggle
        access: read-only
        description: "Input Frame input toggle"
      - name: SlaveCount
        offset: 10
        type_name: UINT
        size: 2
        fastcs_attr: SlaveCount
        access: read-only
        description: "Slave count"
      - name: DevState
        offset: 14
        type_name: UINT
        size: 2
        fastcs_attr: DevState
        access: read-only
        description: "Device Input Status"

  "Outputs_TYPE":
    description: "EtherCAT Master device outputs"
    ads_type: 65
    size: 6
    members:
      - name: Frm0Ctrl
        offset: 0
        type_name: UINT
        size: 2
        fastcs_attr: Frm0Ctrl
        access: read-write
        description: "Output Frame control"
      - name: Frm0WcCtrl
        offset: 2
        type_name: UINT
        size: 2
        fastcs_attr: Frm0WcCtrl
        access: read-write
        description: "Output Frame working counter control"
      - name: DevCtrl
        offset: 4
        type_name: UINT
        size: 2
        fastcs_attr: DevCtrl
        access: read-write
        description: "Device Output control"

  # ============================================================
  # Oversampling Analog Input Types (EL3702)
  # ============================================================

  "Ch1 CycleCount_TYPE":
    description: "16-bit oversampling cycle count"
    ads_type: 65
    size: 2
    members:
      - name: CycleCount
        offset: 0
        type_name: UINT
        size: 2
        fastcs_attr: CycleCount
        access: read-only
        description: "Cycle count for 16-bit analog input oversampling"

  "Ch1 Sample 0_TYPE_ARR":
    description: "16-bit oversampling samples array (100 samples)"
    ads_type: 65
    size: 200 # 100 samples * 2 bytes
    array_size: 100
    members:
      - name: Samples
        offset: 0
        type_name: INT
        size: 200
        array_size: 100
        fastcs_attr: Samples
        access: read-only
        description: "Sample array for 16-bit analog input oversampling"

  # ============================================================
  # Multi-function Analog Input Types (ELM3704)
  # ============================================================

  "PAI Status Channel 1_TYPE":
    description: "24-bit multi-function analog input status"
    ads_type: 65
    size: 4
    members:
      - name: Status
        offset: 0
        type_name: DINT
        size: 4
        fastcs_attr: Status
        access: read-only
        description: "Status for 24-bit multi-function analog input"

  "PAI Timestamp Channel 1_TYPE":
    description: "24-bit multi-function analog input timestamp"
    ads_type: 65
    size: 8
    members:
      - name: StartTimeNextLatch
        offset: 0
        type_name: ULINT
        size: 8
        fastcs_attr: StartTimeNextLatch
        access: read-only
        description: "Timing for 24-bit multi-function analog input"

  "PAI Samples 50 Channel 1_TYPE":
    description: "24-bit multi-function analog input samples array (50 samples)"
    ads_type: 65
    size: 200 # 50 samples * 4 bytes
    array_size: 50
    members:
      - name: Samples
        offset: 0
        type_name: DINT
        size: 200
        array_size: 50
        fastcs_attr: Samples
        access: read-only
        description: "Sample array for 24-bit multi-function analog input"

  "PAI Synchronous Oversampling Channel 1_TYPE":
    description: "24-bit multi-function analog input synchronisation"
    ads_type: 65
    size: 2
    members:
      - name: SMSynchron
        offset: 0
        type_name: UINT
        size: 2
        fastcs_attr: SMSynchron
        access: read-only
        description: "Synchronisation for 24-bit multi-function analog input"
