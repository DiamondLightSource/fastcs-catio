# ADS Runtime Symbols
# ========================================================
# These symbols are added dynamically by the TwinCAT/EtherCAT runtime
# and are not defined in Beckhoff's ESI XML files.
#
# Each symbol can specify:
#   - whitelist: Only apply to these terminal types (if specified)
#   - blacklist: Exclude from these terminal types (if specified)
#   - group_whitelist: Only apply to terminals in these groups
#   - group_blacklist: Exclude terminals in these groups

# NOTE for the group names use the keys in GROUP_TYPE_LABELS in
#   src/catio_terminals/config/terminal_groups.yaml (not the full labels)
#
# If no whitelist/blacklist is specified, the symbol applies to all terminals.
# Whitelist takes precedence over blacklist.
#
# Note: size and ads_type are computed from type_name using catio_terminals.ads_types
#
# References:
#   - https://infosys.beckhoff.com/content/1033/tc3_io_intro/1257993099.html
#   - https://infosys.beckhoff.com/content/1033/ethercatsystem/2469122443.html

runtime_symbols:
  # Working Counter State - indicates if terminal is communicating on EtherCAT bus
  - name_template: WcState.WcState
    index_group: 61489 # 0xF031 - Terminal input/status area
    type_name: BIT
    channels: 1
    access: Read-only
    fastcs_name: wcstate
    description: >
      Working Counter State - EtherCAT diagnostic indicating if the terminal
      is communicating properly on the bus. A non-zero value indicates a
      communication issue.
    # Couplers may not have WcState - exclude them
    group_blacklist:
      - CpBk # Bus Couplers

  # Input Toggle - indicates data freshness
  - name_template: WcState.InputToggle
    index_group: 61489 # 0xF031 - Terminal input/status area
    type_name: BIT
    channels: 1
    access: Read-only
    fastcs_name: input_toggle
    description: >
      Toggles on each EtherCAT cycle to indicate that input data has been
      updated. Can be used to detect stale data.
    # Typically only on terminals with inputs (and power supplies per hardware observation)
    group_whitelist:
      - DigIn
      - AnaIn
      - Measuring
      - PowerSupply

  # InfoData State - device state from EtherCAT state machine
  # NOTE: Disabled - hardware testing shows this symbol does not appear in ADS symbol table
  # - name_template: InfoData.State
  #   index_group: 61472 # 0xF020 - RWIB (input bytes)
  #   type_name: UINT
  #   channels: 1
  #   access: Read-only
  #   fastcs_name: InfodataState
  #   description: >
  #     Device state information from the EtherCAT state machine.
  #     Values: 1=Init, 2=Pre-Op, 3=Bootstrap, 4=Safe-Op, 8=Op
  #   # May not apply to all terminal types - TBD based on testing
  #   group_whitelist:
  #     - DigIn
  #     - DigOut
  #     - AnaIn
  #     - AnaOut
  #     - Measuring

  # SyncUnits - TwinCAT synchronization unit WcState
  # This is a global symbol not tied to specific terminals
  - name_template: SyncUnits._default_._unreferenced_.WcState.WcState
    index_group: 61489 # 0xF031 - Input/status area
    type_name: BIT
    channels: 1
    access: Read-only
    fastcs_name: sync_units_wc_state
    description: >
      Working Counter State for TwinCAT's default synchronization unit.
      Part of TwinCAT's distributed clock (DC) synchronization system.
    is_global: true # Not tied to specific terminals
